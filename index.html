<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ho.ax - blog</title>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/css/grid.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/css/style.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/css/highlight.css" media="screen">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://ho.ax/feed.xml">
  </head>
  <body>
      <div id="container">
        <div id="header">
          <div class="container_12">
            <div class="grid_6">
              <h1><a href="/">ho/ax.</a></h1>
            </div>
            <div class="grid_6">
              <div class="media">
                <div style="float: left"><a class="twitter" href="http://twitter.com/snare"></a></div>
                <div style="float: left"><a class="rss" href="/feed.xml"></a></div>
              </div>
            </div>
          </div>
        </div>
        <div id="splitbar">&nbsp;</div>
        <div id="main">
          <div class="container_12">
            <div class="grid_9">
              <div id="content">
                

	<h1><a href="/posts/2015/05/building-voltron-command-plugins/">Building Voltron Command Plugins</a></h1>
<p class="metadata">
	Posted by snare on 8 May 2015. Tags: <a class="tag" href="/tag/voltron/" rel="tag">voltron</a>, <a class="tag" href="/tag/debugging/" rel="tag">debugging</a>, <a class="tag" href="/tag/gdb/" rel="tag">gdb</a>, <a class="tag" href="/tag/lldb/" rel="tag">lldb</a>
</p>

<p>In <a href="/posts/2014/12/building-voltron-views">a previous post</a> I described how to build views for Voltron. In this short post I’ll cover building command plugins for Voltron.</p>

<p>The debugger hosts supported by Voltron each provide a method of adding user-defined commands to the debugger CLI. Voltron’s command plugin API provides a way to implement user-defined commands that are debugger-agnostic - so the commands will work in any supported debugger host that implements the full Voltron debugger host adaptor API, and supports command plugins (LLDB and GDB at this stage). This is the case provided that the command implementation only uses functions provided by the debugger host adaptor API, otherwise the command plugin would have to individually support each debugger host.</p>

<h2 id="hello-world">Hello world</h2>

<p>A basic example command plugin:</p>

<pre><code class="language-python"><span class="kn">import</span> <span class="nn">voltron</span>
<span class="kn">from</span> <span class="nn">voltron.plugin</span> <span class="kn">import</span> <span class="n">CommandPlugin</span>
<span class="kn">from</span> <span class="nn">voltron.command</span> <span class="kn">import</span> <span class="n">VoltronCommand</span>


<span class="k">class</span> <span class="nc">HelloCommand</span><span class="p">(</span><span class="n">VoltronCommand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'ohai ^_^'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HelloCommandPlugin</span><span class="p">(</span><span class="n">CommandPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'hello'</span>
    <span class="n">command_class</span> <span class="o">=</span> <span class="n">HelloCommand</span></code></pre>

<p>This example is fairly straight-forward. First we have the <code>HelloCommand</code> class, which subclasses <code>VoltronCommand</code> - this is the implementation of the actual command. The <code>invoke</code> method is called when the command is invoked in the debugger. Then we have the <code>HelloCommandPlugin</code> class, which subclasses <code>CommandPlugin</code>. This is the plugin class that is registered in Voltron’s plugin registry. It specifies the command to register (‘hello’) and the class that contains the command’s implementation.</p>

<p>Installing it:</p>

<pre><code>$ ln -s /path/to/hello.py ~/.voltron/plugins/
</code></pre>

<p>Executing it:</p>

<pre><code>$ lldb
Voltron loaded.
Run `voltron init` after you load a target.
(lldb) hello
ohai ^_^
(lldb)
</code></pre>

<p>Easy.</p>

<h2 id="a-simple-register-list-command">A simple register list command</h2>

<p>Now for an example that uses the debugger host adaptor API. This interface isn’t documented yet, but the main methods map one-to-one with the methods defined in the <a href="https://github.com/snare/voltron/wiki/JSON-API-reference">JSON API reference</a>. Have a look at <code>voltron/plugins/debugger/dbg_lldb.py</code>.</p>

<pre><code class="language-python"><span class="kn">import</span> <span class="nn">blessed</span>
<span class="kn">import</span> <span class="nn">voltron</span>
<span class="kn">from</span> <span class="nn">voltron.plugin</span> <span class="kn">import</span> <span class="n">CommandPlugin</span>
<span class="kn">from</span> <span class="nn">voltron.command</span> <span class="kn">import</span> <span class="n">VoltronCommand</span>


<span class="k">class</span> <span class="nc">ExampleCommand</span><span class="p">(</span><span class="n">VoltronCommand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">regs</span> <span class="o">=</span> <span class="n">voltron</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">registers</span><span class="p">()</span>
        <span class="n">reg_list</span> <span class="o">=</span>  <span class="p">[</span><span class="s">'rax'</span><span class="p">,</span><span class="s">'rbx'</span><span class="p">,</span><span class="s">'rcx'</span><span class="p">,</span><span class="s">'rdx'</span><span class="p">,</span><span class="s">'rbp'</span><span class="p">,</span><span class="s">'rsp'</span><span class="p">,</span><span class="s">'rdi'</span><span class="p">,</span><span class="s">'rsi'</span><span class="p">,</span><span class="s">'rip'</span><span class="p">,</span>
                     <span class="s">'r8'</span><span class="p">,</span><span class="s">'r9'</span><span class="p">,</span><span class="s">'r10'</span><span class="p">,</span><span class="s">'r11'</span><span class="p">,</span><span class="s">'r12'</span><span class="p">,</span><span class="s">'r13'</span><span class="p">,</span><span class="s">'r14'</span><span class="p">,</span><span class="s">'r15'</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">reg_list</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"{t.bold}{:3} {t.normal}{:0=16X}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">regs</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="n">blessed</span><span class="o">.</span><span class="n">Terminal</span><span class="p">()))</span>


<span class="k">class</span> <span class="nc">ExampleCommandPlugin</span><span class="p">(</span><span class="n">CommandPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'example'</span>
    <span class="n">command_class</span> <span class="o">=</span> <span class="n">ExampleCommand</span></code></pre>

<p>You can see the <code>invoke</code> method there calls <code>voltron.debugger.registers()</code> to get the current values for the registers in the current inferior. <code>voltron.debugger</code> is the package-wide reference to the current debugger host adaptor object. In LLDB, this will be an instance of <code>LLDBAdaptor</code> which is defined in <code>voltron/plugins/debugger/dbg_lldb.py</code>. Similarly, in GDB this will be an instance of <code>GDBAdaptor</code> from <code>voltron/plugins/debugger/dbg_gdb.py</code>. Both classes implement most of the same methods (including <code>registers</code>).</p>

<p>Install it as per the previous example:</p>

<pre><code>$ ln -s /path/to/example.py ~/.voltron/plugins/
</code></pre>

<p>Executing it:</p>

<pre><code>(lldb) example
rax 0000000100000CF0
rbx 0000000000000000
rcx 00007FFF5FBFFAA0
rdx 00007FFF5FBFF9B0
rbp 00007FFF5FBFF990
rsp 00007FFF5FBFF988
rdi 0000000000000001
rsi 00007FFF5FBFF9A0
rip 0000000100000CF0
r8  0000000000000000
r9  00007FFF5FBFEA48
r10 0000000000000032
r11 0000000000000246
r12 0000000000000000
r13 0000000000000000
r14 0000000000000000
r15 0000000000000000
</code></pre>

<h2 id="an-lldb-specific-command-plugin">An LLDB-specific command plugin</h2>

<p>If the adaptor API doesn’t cover what you want to do in command plugins, you can access the host debugger instance itself and perform debugger API-specific actions. Here’s an example of an API plugin that calls LLDB’s <code>SBDebugger.GetVersionString()</code>:</p>

<pre><code class="language-python"><span class="kn">import</span> <span class="nn">voltron</span>
<span class="kn">from</span> <span class="nn">voltron.plugin</span> <span class="kn">import</span> <span class="n">CommandPlugin</span>
<span class="kn">from</span> <span class="nn">voltron.command</span> <span class="kn">import</span> <span class="n">VoltronCommand</span>


<span class="k">class</span> <span class="nc">LLDBHelloCommand</span><span class="p">(</span><span class="n">VoltronCommand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Debugger host: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltron</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">host</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Do an LLDB thing: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltron</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">GetVersionString</span><span class="p">()))</span>


<span class="k">class</span> <span class="nc">LLDBHelloCommandPlugin</span><span class="p">(</span><span class="n">CommandPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'lldbhello'</span>
    <span class="n">command_class</span> <span class="o">=</span> <span class="n">LLDBHelloCommand</span></code></pre>

<p>It’s installed the same way as the previous examples. Executing it:</p>

<pre><code>$ lldb
Voltron loaded.
Run `voltron init` after you load a target.
(lldb) lldbhello
Debugger host: Debugger (instance: "debugger_1", id: 1)
Do an LLDB thing: lldb-320.3.103
</code></pre>

<p>Of course, if you want LLDB-specific features you can always just use the normal LLDB command script API to implement your plugin, rather than the Voltron API, but it’s more fun this way.</p>

<p>So that’s about it. Have a look at the debugger adaptor plugins for the methods you can use in a command plugin in order to be supported cross-debugger host.</p>

	<hr/>

	<h1><a href="/posts/2014/12/building-voltron-views/">Building Voltron Views</a></h1>
<p class="metadata">
	Posted by snare on 20 December 2014. Tags: <a class="tag" href="/tag/voltron/" rel="tag">voltron</a>, <a class="tag" href="/tag/debugging/" rel="tag">debugging</a>, <a class="tag" href="/tag/gdb/" rel="tag">gdb</a>, <a class="tag" href="/tag/lldb/" rel="tag">lldb</a>
</p>

<p>In <a href="/posts/2013/06/voltron-a-hacky-ui-for-gdb/">2013</a> I released a small debugger UI tool called <a href="https://github.com/snare/voltron">Voltron</a>. In the last few months I completely rewrote the guts of it to be much more extensible, and gave a short talk at <a href="https://www.kiwicon.org/the-con/talks/#e163">Kiwicon 8</a> on it, so I figured it was about time for an update. This post will take you through building new Voltron views for your own purposes.</p>

<p>Some of the information in this blog post is covered in the documentation on the <a href="https://github.com/snare/voltron/wiki/">wiki</a>.</p>

<p>Note: I’m using LLDB in this post, but you can use GDB and it will be much the same.</p>

<h2 id="poking-around-in-the-repl">Poking around in the REPL</h2>

<p>Whenever I write Python I spend a lot of time poking around in classes in a REPL, often in lieu of actually consulting the documentation, so that seems like a good place to start.</p>

<p>First off let’s fire up LLDB with an inferior, initialise Voltron, set a breakpoint and run the executable so we have some useful debugger state to poke at. I’m using the test inferior from the Voltron package, but use whatever.</p>

<pre><code>$ lldb tests/inferior
Voltron loaded.
Run `voltron init` after you load a target.
Current executable set to 'tests/inferior' (x86_64).
(lldb) voltron init
Registered stop-hook
(lldb) b main
Breakpoint 1: where = inferior`main, address = 0x0000000100000cf0
(lldb) run
Process 16669 launched: '~/code/voltron/repo/tests/inferior' (x86_64)
Process 16669 stopped
* thread #1: tid = 0x1a2238, 0x0000000100000cf0 inferior`main, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
    frame #0: 0x0000000100000cf0 inferior`main
inferior`main:
-&gt; 0x100000cf0:  push   rbp
   0x100000cf1:  mov    rbp, rsp
   0x100000cf4:  sub    rsp, 0x50
   0x100000cf8:  mov    dword ptr [rbp - 0x4], 0x0
(lldb)
</code></pre>

<p>Now load up a Python REPL in another terminal (I use <a href="http://bpython-interpreter.org/">bpython</a>) and import the Voltron package. We can then instantiate a Voltron client object, connect to the Voltron server running in the debugger, and issue API requests.</p>

<pre><code class="language-python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">voltron</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">voltron.core</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'state'</span><span class="p">)</span>
<span class="o">&lt;&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">state</span><span class="o">.</span><span class="n">APIStateResponse</span><span class="s">'&gt;: success = True, error = False, body: {'</span><span class="n">status</span><span class="s">': u'</span><span class="n">success</span><span class="s">', '</span><span class="n">state</span><span class="s">': u'</span><span class="n">stopped</span><span class="s">', '</span><span class="nb">type</span><span class="s">': u'</span><span class="n">response</span><span class="s">'}&gt;</span></code></pre>

<p>The <code>perform_request()</code> function creates an API request of the specified type with the given parameters (none in this case), sends it to the server, and returns an instance of a subclass of <code>APIResponse</code> containing the response. In this example we’ve queried the state of the debugger and can see that the request was successful, and that the debugger is stopped.</p>

<p>Now let’s try getting the contents of a register, say <code>RSP</code>, with the <code>registers</code> API method:</p>

<pre><code class="language-python"><span class="o">&gt;&gt;&gt;</span> <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'registers'</span><span class="p">,</span> <span class="n">registers</span><span class="o">=</span><span class="p">[</span><span class="s">'rsp'</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">res</span><span class="o">.</span><span class="n">is_success</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">res</span><span class="o">.</span><span class="n">registers</span>
<span class="p">{</span><span class="s">u'rsp'</span><span class="p">:</span> <span class="mi">140734799804616</span><span class="p">}</span></code></pre>

<p>Now we’ll read some memory from the inferior’s stack using the value of the stack pointer register we just got:</p>

<pre><code class="language-python"><span class="o">&gt;&gt;&gt;</span> <span class="n">rsp</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">'rsp'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'memory'</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">rsp</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mh">0x40</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">res</span><span class="o">.</span><span class="n">memory</span>
<span class="s">'</span><span class="se">\xfd\x05\xf1\x92\xff\x7f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00</span><span class="s">X</span><span class="se">\xfa\xbf</span><span class="s">_</span><span class="se">\xff\x7f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x93\xfa\xbf</span><span class="s">_</span><span class="se">\xff\x7f\x00\</span>
<span class="s">x00</span><span class="se">\xaa\xfa\xbf</span><span class="s">_</span><span class="se">\xff\x7f\x00\x00\xbe\xfa\xbf</span><span class="s">_</span><span class="se">\xff\x7f\x00\x00</span><span class="s">'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">res</span><span class="o">.</span><span class="n">bytes</span>
<span class="mi">64</span></code></pre>

<p>One more important API method worth noting at this point is the <code>wait</code> method. The server will only return a response once the specified debugger state change has occurred. Currently the only state change supported is ‘stopped’ - signaling that the debugger has stopped for some reason (for example a breakpoint was hit, the user stepped over an instruction, etc). This is the default state change, so we don’t need to specify it.</p>

<pre><code>&gt;&gt;&gt; res = client.perform_request('wait')
</code></pre>

<p>Now in the debugger:</p>

<pre><code>(lldb) stepi
Process 16669 stopped
* thread #1: tid = 0x1a2238, 0x0000000100000cf1 inferior`main + 1, queue = 'com.apple.main-thread', stop reason = instruction step into
    frame #0: 0x0000000100000cf1 inferior`main + 1
inferior`main + 1:
-&gt; 0x100000cf1:  mov    rbp, rsp
   0x100000cf4:  sub    rsp, 0x50
   0x100000cf8:  mov    dword ptr [rbp - 0x4], 0x0
   0x100000cff:  mov    dword ptr [rbp - 0x8], edi
(lldb)
</code></pre>

<p>And the <code>perform_request()</code> function should have returned a successful response:</p>

<pre><code>&gt;&gt;&gt; res
&lt;&lt;class 'wait.APIWaitResponse'&gt;: success = True, error = False, body: {'status': u'success', 'state': u'stopped', 'type': u'response'}&gt;
</code></pre>

<p>See the <a href="https://github.com/snare/voltron/wiki/JSON-API-reference">API reference</a> for information on the supported core API methods.</p>

<h2 id="building-a-simple-standalone-client">Building a simple standalone client</h2>

<p>Now that we have a basic understanding of how the API works, let’s build a simple client.</p>

<pre><code class="language-python"><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">voltron</span>
<span class="kn">from</span> <span class="nn">voltron.core</span> <span class="kn">import</span> <span class="n">Client</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c"># Create a client and connect to the server</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

    <span class="c"># Main event loop</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c"># Wait for the debugger to stop again</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'wait'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
            <span class="c"># If nothing went wrong, get the instruction pointer and print it</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'registers'</span><span class="p">,</span> <span class="n">registers</span><span class="o">=</span><span class="p">[</span><span class="s">'rip'</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Instruction pointer is: 0x{:X}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">'rip'</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Failed to get registers: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Error waiting for the debugger to stop: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
            <span class="k">break</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></code></pre>

<p>Pretty self-explanatory - we’ve basically just put together all the bits discussed in the previous section. We use the <code>wait</code> method to construct a main event loop that executes some stuff every time the debugger stops. The stuff that we execute just grabs the contents of the <code>RIP</code> register and prints it out. Hooray!</p>

<p>If we run the client and then <code>stepi</code> a few times in the debugger, the output from the client looks something like this:</p>

<pre><code>$ python client.py
Instruction pointer is: 0x100000CF8
Instruction pointer is: 0x100000CFF
Instruction pointer is: 0x100000D02
Instruction pointer is: 0x100000D06
Instruction pointer is: 0x100000D0D
</code></pre>

<h2 id="building-a-simple-view-plugin">Building a simple view plugin</h2>

<p>OK, so we get the gist of how the API works and we’ve used it to build a simple standalone client. Now let’s turn our standalone example into a simple view plugin. Each of the core views included with Voltron that are accessible via the <code>voltron view</code> command is implemented as a view plugin like this.</p>

<p>First, we need to subclass <code>ViewPlugin</code> from the <code>voltron.view</code> module. This is the main entry point for the plugin and contains the name of the plugin and a reference to the main view class for the plugin.</p>

<pre><code class="language-python"><span class="kn">from</span> <span class="nn">voltron.plugin</span> <span class="kn">import</span> <span class="n">ViewPlugin</span>

<span class="k">class</span> <span class="nc">ExampleViewPlugin</span><span class="p">(</span><span class="n">ViewPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'example'</span>
    <span class="n">view_class</span> <span class="o">=</span> <span class="n">ExampleView</span></code></pre>

<p>Since this contains a reference to the view class, the view class will need to be defined before the plugin class in the file. So above the plugin class we’ll define the view class, which subclasses <code>TerminalView</code> from the <code>voltron.view</code> module.</p>

<pre><code class="language-python"><span class="kn">from</span> <span class="nn">voltron.view</span> <span class="kn">import</span> <span class="n">TerminalView</span>

<span class="k">class</span> <span class="nc">ExampleView</span><span class="p">(</span><span class="n">TerminalView</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'registers'</span><span class="p">,</span> <span class="n">registers</span><span class="o">=</span><span class="p">[</span><span class="s">'rip'</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Instruction pointer is: 0x{:X}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">'rip'</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Failed to get registers: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">))</span></code></pre>

<p>The important attribute is the <code>render()</code> method. The TerminalView class (well, actually its parent, the <code>VoltronView</code>  class) implements something similar to the main event loop in our example standalone client; each time the debugger stops, the view’s <code>render()</code> method is called.</p>

<p>The parent classes define a few useful attributes. Firstly the <code>clear()</code> method which we call at the beginning of the <code>render()</code> method to clear the screen. Secondly, a <code>Client</code> instance called <code>client</code>.</p>

<p>After that we do pretty much the same thing as in our standalone example, only using the view’s included client object.</p>

<p>The complete example:</p>

<pre><code class="language-python"><span class="kn">from</span> <span class="nn">voltron.view</span> <span class="kn">import</span> <span class="n">TerminalView</span>
<span class="kn">from</span> <span class="nn">voltron.plugin</span> <span class="kn">import</span> <span class="n">ViewPlugin</span>


<span class="k">class</span> <span class="nc">ExampleView</span><span class="p">(</span><span class="n">TerminalView</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'registers'</span><span class="p">,</span> <span class="n">registers</span><span class="o">=</span><span class="p">[</span><span class="s">'rip'</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Instruction pointer is: 0x{:X}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">'rip'</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Failed to get registers: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">ExampleViewPlugin</span><span class="p">(</span><span class="n">ViewPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'example'</span>
    <span class="n">view_class</span> <span class="o">=</span> <span class="n">ExampleView</span></code></pre>

<p>If you put this code into a file and symlink it into your Voltron plugins directory, like so:</p>

<pre><code>$ ln -s /path/to/example.py ~/.voltron/plugins/
</code></pre>

<p>You should now see the plugin listed in the view types at the command line:</p>

<pre><code>usage: voltron view [-h]
                    {backtrace,register,example,command,memory,disassembly,stack}
                    ...
voltron view: error: too few arguments
</code></pre>

<p>Run the view:</p>

<pre><code>$ voltron view example
</code></pre>

<p>Each time you <code>stepi</code> in the debugger, the text should update:</p>

<pre><code>Instruction pointer is: 0x100000E75
</code></pre>

<p>There’s also some more functionality that the parent classes provide. Here’s a more typical view example:</p>

<pre><code class="language-python"><span class="kn">from</span> <span class="nn">voltron.view</span> <span class="kn">import</span> <span class="n">TerminalView</span>
<span class="kn">from</span> <span class="nn">voltron.plugin</span> <span class="kn">import</span> <span class="n">ViewPlugin</span>


<span class="k">class</span> <span class="nc">ExampleView</span><span class="p">(</span><span class="n">TerminalView</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># Perform the request and set the body to the result</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'registers'</span><span class="p">,</span> <span class="n">registers</span><span class="o">=</span><span class="p">[</span><span class="s">'rip'</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">"Instruction pointer is: 0x{:X}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">'rip'</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">"Failed to get registers: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c"># Set the title and info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'[example]'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s">'some infoz'</span>

        <span class="c"># Let the parent do the rendering</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExampleView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ExampleViewPlugin</span><span class="p">(</span><span class="n">ViewPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'example'</span>
    <span class="n">view_class</span> <span class="o">=</span> <span class="n">ExampleView</span></code></pre>

<p>In this example, rather than printing the view contents out directly, we set <code>self.body</code> to the output we want in the main body of the view, and set <code>self.title</code> and <code>self.info</code> to what we want in the title and info fields respectively.</p>

<p>We then let the parent classes render it, which should look something like this:</p>

<p><img src="http://i.imgur.com/ALyiiTB.png" alt="example view"></p>

<p>Finally, with some small modifications we can turn this into an x86_64 register view:</p>

<pre><code class="language-python"><span class="kn">from</span> <span class="nn">voltron.view</span> <span class="kn">import</span> <span class="n">TerminalView</span>
<span class="kn">from</span> <span class="nn">voltron.plugin</span> <span class="kn">import</span> <span class="n">ViewPlugin</span>


<span class="k">class</span> <span class="nc">ExampleView</span><span class="p">(</span><span class="n">TerminalView</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># Perform the request</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">perform_request</span><span class="p">(</span><span class="s">'registers'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
            <span class="c"># Process the registers and set the body to the formatted list</span>
            <span class="n">reg_list</span> <span class="o">=</span>  <span class="p">[</span><span class="s">'rax'</span><span class="p">,</span><span class="s">'rbx'</span><span class="p">,</span><span class="s">'rcx'</span><span class="p">,</span><span class="s">'rdx'</span><span class="p">,</span><span class="s">'rbp'</span><span class="p">,</span><span class="s">'rsp'</span><span class="p">,</span><span class="s">'rdi'</span><span class="p">,</span><span class="s">'rsi'</span><span class="p">,</span><span class="s">'rip'</span><span class="p">,</span>
                         <span class="s">'r8'</span><span class="p">,</span><span class="s">'r9'</span><span class="p">,</span><span class="s">'r10'</span><span class="p">,</span><span class="s">'r11'</span><span class="p">,</span><span class="s">'r12'</span><span class="p">,</span><span class="s">'r13'</span><span class="p">,</span><span class="s">'r14'</span><span class="p">,</span><span class="s">'r15'</span><span class="p">]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'{:3}: {:016X}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="n">reg_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">"Failed to get registers: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c"># Set the title and info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'[example]'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s">'some infoz'</span>

        <span class="c"># Let the parent do the rendering</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExampleView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ExampleViewPlugin</span><span class="p">(</span><span class="n">ViewPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'example'</span>
    <span class="n">view_class</span> <span class="o">=</span> <span class="n">ExampleView</span></code></pre>

<p>Looking something like this:</p>

<p><img src="http://i.imgur.com/lZkwL0e.png" alt="example view reg"></p>

<p>We can now modify the way the view is displayed, say to show the footer, with the automatically-added command line flags:</p>

<pre><code>$ voltron view example -h
usage: voltron view example [-h] [--show-header] [--hide-header]
                            [--show-footer] [--hide-footer] [--name NAME]

optional arguments:
  -h, --help            show this help message and exit
  --show-header, -e     show header
  --hide-header, -E     hide header
  --show-footer, -f     show footer
  --hide-footer, -F     hide footer
  --name NAME, -n NAME  named configuration to use
$ voltron view example -f
</code></pre>

<p>Which should look like this:</p>

<p><img src="http://i.imgur.com/CY5oOqO.png" alt="example view footer"></p>

<p>We can also configure the header and footer contents in the config file (<code>~/.voltron/config</code>) like this:</p>

<pre><code>{
    "view": {
        "example_view": {
            "footer": {
                "show": true,
                "label_left": {
                    "name":         "title",
                    "colour":       "red",
                    "bg_colour":    "grey",
                    "attrs":        ["bold"]
                },
                "label_right": {
                    "name":         "info",
                    "colour":       "white",
                    "bg_colour":    "grey",
                    "attrs":        []
                }
            },
            "header": {
                "show": false
            }
        }
    }
}
</code></pre>

<p>This configuration should be fairly self-explanatory. It will hide the header, and the footer will contain the title in red on the left, and the info field in white on the right, like this:</p>

<p><img src="http://i.imgur.com/zmxl9Iv.png" alt="example view config"></p>

<h2 id="until-next-time">Until next time…</h2>

<p>This should give you a good starting point for building Voltron views. See the source for the views included with the Voltron package for more clues.</p>

<p>The next post will describe how to build Voltron API plugins to add server-side functionality that you can access from your views.</p>

	<hr/>

	<h1><a href="/posts/2013/10/calculon-a-calculator-for-nerds/">Calculon - a calculator for nerds</a></h1>
<p class="metadata">
	Posted by snare on 8 October 2013. Tags: <a class="tag" href="/tag/calculon/" rel="tag">calculon</a>, <a class="tag" href="/tag/voltron/" rel="tag">voltron</a>
</p>

<p><strong>Update December 2014: This post is now somewhat outdated, please see the <a href="https://github.com/snare/calculon">github repo</a> for more up to date information.</strong></p>

<p><strong>Can’t sleep. Write blog post.</strong></p>

<p>I used to spend a lot of time using a Python REPL as a calculator, copying and pasting values back and forth between the REPL and Calculator.app, cursing, hitting ctrl-a, typing <code>hex(</code>, hitting ctrl-e, and typing <code>)</code>. I thought <a href="http://www.youtube.com/watch?v=a1h3kEcHbBM">“THERE’S GOT TO BE A BETTER WAY”</a>. Now there is.</p>

<p><a href="https://github.com/snarez/calculon">Calculon</a> - A terminal-based programmer’s calculator endowed with unholy acting talent by the Robot Devil.</p>

<p><img src="https://github-camo.global.ssl.fastly.net/8b00a532694e902f6e0ba3482610043574ecea1c/687474703a2f2f692e696d6775722e636f6d2f536b57646e6c642e706e67" alt="calculon example"></p>

<p>Calculon is basically a curses window jammed on top of a Python REPL (<code>bpython</code> initially). Any code you type into the REPL will be executed as usual, with any numeric values displayed in the interface at the top in a variety of bases and formats. There are a couple of differences to the basic REPL:</p>

<ul>
  <li>
    <p>If the code begins with an operator the line will be prepended with the last result, allowing the user to do something like this:</p>

    <pre><code>  &gt;&gt;&gt; 1234
  1234
  &gt;&gt;&gt; &lt;&lt;1
  2468
</code></pre>
  </li>
  <li>
    <p>If the code is empty (ie. the user just hits enter), the last operation will be re-evaluated:</p>

    <pre><code>  &gt;&gt;&gt;
  4936
  &gt;&gt;&gt;
  9872
  &gt;&gt;&gt;
  19744
  &gt;&gt;&gt;
</code></pre>
  </li>
  <li>
    <p>There are functions called <code>watch()</code> and <code>unwatch()</code> exposed, allowing the user to track variables in the main display (as per the screen capture above).</p>
  </li>
</ul>

<p>Calculon also supports configurable bit length and display width for the binary display, and left/right alignment:</p>

<p><img src="/posts/2013/10/calculon_wide.png" alt="calculon example2"></p>

<p>Check it out on my <a href="https://github.com/snarez/calculon">github</a>.</p>

<p>There are a few things that I (and my pal <a href="https://github.com/richo">richo</a>) plan to do to it in the near future:</p>

<ul>
  <li>Decouple the display window and REPL, allowing them to be executed in different terminals (ala <a href="https://github.com/snarez/voltron">Voltron</a>)</li>
  <li>Add support for other REPLs (e.g. IPython)</li>
  <li>Add glue between Calculon and <a href="https://github.com/snarez/voltron">Voltron</a>, allowing it to be used as a display for watching registers/memory</li>
</ul>

	<hr/>

	<h1><a href="/posts/2013/06/voltron-a-hacky-ui-for-gdb/">Voltron - a hacky UI for GDB</a></h1>
<p class="metadata">
	Posted by snare on 25 June 2013. Tags: <a class="tag" href="/tag/voltron/" rel="tag">voltron</a>, <a class="tag" href="/tag/gdb/" rel="tag">gdb</a>, <a class="tag" href="/tag/debugging/" rel="tag">debugging</a>
</p>

<p><strong>Update December 2014: This post is now somewhat outdated, please see the <a href="https://github.com/snare/voltron">github repo</a> for more up to date information.</strong></p>

<p>Wow, first post for 2013 and it’s June already. I suck at this blogging thing. If you’ve been following my Twitter, you probably know that I’m now working at Azimuth Security. I’ll also be speaking at the <a href="http://nsc.is">Nordic Security Conference</a> in Reykjavik, Iceland in September - details will follow when I think of a name for my talk.</p>

<p>Now. Unfortunately, GDB is the only viable option for some debugging tasks - for example, I haven’t found anything else that seems to work properly with VMware’s debug stub. Everybody’s pal <a href="http://reverse.put.as">fG!</a> has done a great job with his <code>gdbinit</code>, which I’ve used for quite a while now, but as I’ve been using GDB version 7 a bit lately I decided to have a go at recreating some of the context info his <code>gdbinit</code> gives you in a python interface. This is the result:</p>

<p><img src="/posts/2013/06/example.png" alt="voltron example"></p>

<p>Voltron is a python script that can be executed inside and outside of GDB. The code that runs inside GDB spins off a server thread and feeds out context information to clients that register for notifications. The code that runs outside GDB connects to the server, consumes this context information and renders it in a terminal. The idea being that you can tack a bunch of utility views onto GDB in other terminal windows (or iTerm panes, which is what I do).</p>

<p>It’s super hacky (I built it in a night in a fit of frustration), has some bugs, and needs a good refactoring, but it makes my life easier so I figured I should share it.</p>

<p>The code and documentation is on my <a href="http://github.com/snarez/voltron">GitHub</a>.</p>

	<hr/>

	<h1><a href="/posts/2012/12/te-loader-for-ida-pro/">TE loader for IDA Pro</a></h1>
<p class="metadata">
	Posted by snare on 20 December 2012. Tags: <a class="tag" href="/tag/efi/" rel="tag">efi</a>, <a class="tag" href="/tag/ida pro/" rel="tag">ida pro</a>, <a class="tag" href="/tag/idapython/" rel="tag">idapython</a>, <a class="tag" href="/tag/reversing/" rel="tag">reversing</a>
</p>

<p>The EFI documentation defines a simplified version of the PE32 image format, called “TE”, which is intended to reduce the overheads of the PE/COFF headers. The document in which this format is defined can be found <a href="http://www.intel.com/content/dam/doc/reference-guide/efi-pei-cis-v091.pdf">here</a>. Apple’s EFI firmare (or at least one version I was looking at) uses the TE image format for the SEC phase binary, but IDA Pro doesn’t seem to understand TE, so I decided to have a crack at writing a loader to handle TE images. This post describes both a bit about the TE image format, and how to go about writing a basic image loader for IDA Pro in Python.</p>

<p>First, a quick look at the TE image format. It is a stripped down version of PE32, so if you’re familiar with that then you’ll probably recognise these fields. The main image header looks something like this:</p>

<pre><code class="language-c"><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">UINT16</span>                   <span class="n">Signature</span><span class="p">;</span>
    <span class="n">UINT16</span>                   <span class="n">Machine</span><span class="p">;</span>
    <span class="n">UINT8</span>                    <span class="n">NumberOfSections</span><span class="p">;</span>
    <span class="n">UINT8</span>                    <span class="n">Subsystem</span><span class="p">;</span>
    <span class="n">UINT16</span>                   <span class="n">StrippedSize</span><span class="p">;</span>
    <span class="n">UINT32</span>                   <span class="n">AddressOfEntryPoint</span><span class="p">;</span>
    <span class="n">UINT32</span>                   <span class="n">BaseOfCode</span><span class="p">;</span>
    <span class="n">UINT64</span>                   <span class="n">ImageBase</span><span class="p">;</span>
    <span class="n">EFI_IMAGE_DATA_DIRECTORY</span> <span class="n">DataDirectory</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">TEImageHeader</span><span class="p">;</span></code></pre>

<p>With the <code>EFI_IMAGE_DATA_DIRECTORY</code> structure looking like this:</p>

<pre><code class="language-c"><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">UINT32</span> <span class="n">VirtualAddress</span><span class="p">;</span>
    <span class="n">UINT32</span> <span class="n">Size</span><span class="p">;</span>
<span class="p">}</span> <span class="n">EFI_IMAGE_DATA_DIRECTORY</span><span class="p">;</span></code></pre>

<p>Directly following the main header is a set of section headers (<code>NumberOfSections</code> of them, funnily enough) that look like this:</p>

<pre><code class="language-c"><span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
    <span class="kt">char</span>    <span class="n">Name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
    <span class="n">int32</span>   <span class="n">VirtualSize</span><span class="p">;</span> 
    <span class="n">int32</span>   <span class="n">VirtualAddress</span><span class="p">;</span> 
    <span class="n">int32</span>   <span class="n">SizeOfRawData</span><span class="p">;</span>   
    <span class="n">int32</span>   <span class="n">PointerToRawData</span><span class="p">;</span>  
    <span class="n">int32</span>   <span class="n">PointerToRelocations</span><span class="p">;</span>  
    <span class="n">int32</span>   <span class="n">PointerToLinenumbers</span><span class="p">;</span> 
    <span class="n">int16</span>   <span class="n">NumberOfRelocations</span><span class="p">;</span>   
    <span class="n">int16</span>   <span class="n">NumberOfLinenumbers</span><span class="p">;</span> 
    <span class="n">int32</span>   <span class="n">Characteristics</span><span class="p">;</span>  
<span class="p">}</span> <span class="n">SectionHeader</span><span class="p">;</span></code></pre>

<p>Following the section headers is the data for the sections.</p>

<p>So, the first thing I did was put together a basic template for everybody’s favourite hex editor, <a href="http://www.sweetscape.com/010editor/">010 Editor</a>, using the structs defined above:</p>

<pre><code class="language-c"><span class="n">local</span> <span class="n">int32</span> <span class="n">i</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">UBYTE</span> <span class="n">UINT8</span><span class="p">;</span>

<span class="c1">// insert those structs I defined above</span>

<span class="k">struct</span> <span class="nf">SectionData</span> <span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
<span class="p">};</span>

<span class="n">TEImageHeader</span> <span class="n">header</span><span class="p">;</span>
<span class="n">SectionHeader</span> <span class="n">sec_header</span><span class="p">[</span><span class="n">header</span><span class="p">.</span><span class="n">NumberOfSections</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">header</span><span class="p">.</span><span class="n">NumberOfSections</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">SectionData</span> <span class="n">section</span><span class="p">(</span><span class="n">sec_header</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">SizeOfRawData</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>This results in something that looks about right:</p>

<p><img src="/posts/2012/12/010.png" alt="010dump"></p>

<p>The next step was to rewrite it in Python, which went something like this:</p>

<pre><code class="language-python"><span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">awesome_print</span> <span class="kn">import</span> <span class="n">ap</span> <span class="k">as</span> <span class="n">pp</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span>

<span class="k">class</span> <span class="nc">TEImage</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="c"># read header</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sections</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsystem</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stripped_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_point_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">code_base</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_base</span><span class="p">)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">"&lt;HHBBHLLQ"</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>
        <span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">d3</span><span class="p">,</span><span class="n">d4</span><span class="p">)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">"&lt;IIII"</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="p">[(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">),(</span><span class="n">d3</span><span class="p">,</span><span class="n">d4</span><span class="p">)]</span>

        <span class="c"># read section table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sections</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TEImageSection</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">TEImageSection</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="c"># read header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">virt_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">virt_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_to_data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ptr_to_relocs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_to_line_nums</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_relocs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_line_nums</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">characteristics</span><span class="p">)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">"&lt;LLLLLLHHL"</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">te</span> <span class="o">=</span> <span class="n">TEImage</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">pp</span><span class="p">(</span><span class="n">te</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">te</span><span class="o">.</span><span class="n">sections</span><span class="p">)):</span>
        <span class="k">print</span> <span class="s">"section </span><span class="si">%i</span><span class="s">:"</span> <span class="o">%</span> <span class="n">i</span>
        <span class="n">pp</span><span class="p">(</span><span class="n">te</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span></code></pre>

<p>Pretty self-explanatory - classes for the image and section headers using the <code>struct</code> module to unpack the headers, and the main section just creating an image object from whatever file was passed as the first argument and then prettyprinting the contents of the object.</p>

<p>On my binary the output looks like this:</p>

<pre><code>{
         subsystem: 11,
     stripped_size: 440,
        image_base: 4294965344,
          data_dir: [
    [0] (
      [0] 2048,
      [1] 28
    ),
    [1] (
      [0] 0,
      [1] 0
    )
  ],
  entry_point_addr: 1024,
         code_base: 640,
      num_sections: 5,
            offset: 0,
           machine: 332,
         signature: 23126,
          sections: [
    [0] &lt;__main__.TEImageSection instance at 0x1058d3ab8&gt;,
    [1] &lt;__main__.TEImageSection instance at 0x1058d3b48&gt;,
    [2] &lt;__main__.TEImageSection instance at 0x1058d3b90&gt;,
    [3] &lt;__main__.TEImageSection instance at 0x1058d3bd8&gt;,
    [4] &lt;__main__.TEImageSection instance at 0x1058d3c20&gt;
  ]
}
section 0:
{
              name: .text,
        num_relocs: 0,
   characteristics: 1610612768,
  ptr_to_line_nums: 0,
     num_line_nums: 0,
         virt_addr: 640,
       ptr_to_data: 640,
            offset: 40,
         virt_size: 359,
         data_size: 384,
     ptr_to_relocs: 0
}
section 1:
{
              name: _TEXT_RE,
        num_relocs: 0,
   characteristics: 1610612768,
  ptr_to_line_nums: 0,
     num_line_nums: 0,
         virt_addr: 1024,
       ptr_to_data: 1024,
            offset: 80,
         virt_size: 59,
         data_size: 64,
     ptr_to_relocs: 0
}
section 2:
{
              name: _TEXT_PR,
        num_relocs: 0,
   characteristics: 1610612768,
  ptr_to_line_nums: 0,
     num_line_nums: 0,
         virt_addr: 1088,
       ptr_to_data: 1088,
            offset: 120,
         virt_size: 920,
         data_size: 928,
     ptr_to_relocs: 0
}
section 3:
{
              name: .data,
        num_relocs: 0,
   characteristics: 3221225536,
  ptr_to_line_nums: 0,
     num_line_nums: 0,
         virt_addr: 2016,
       ptr_to_data: 2016,
            offset: 160,
         virt_size: 32,
         data_size: 32,
     ptr_to_relocs: 0
}
section 4:
{
              name: .reloc,
        num_relocs: 0,
   characteristics: 0,
  ptr_to_line_nums: 0,
     num_line_nums: 0,
         virt_addr: 2048,
       ptr_to_data: 2048,
            offset: 200,
         virt_size: 30,
         data_size: 32,
     ptr_to_relocs: 0
}
</code></pre>

<p>Not pretty, but it looks like it’s doing the job.</p>

<p>The final stage is to add the IDA loading code. IDA loaders can be implemented as fully fledged plugins with the SDK, or as IDC or IDAPython scripts. I obviously chose the last option, because who wouldn’t? IDA loaders rely on two functions: <code>accept_file()</code> and <code>load_file()</code>. <code>accept_file()</code> is called in every loader when a binary is opened in IDA, to ask the loader if it can load that type of file. All we have to do in this function is check the file’s magic number and make sure it looks like a TE binary:</p>

<pre><code class="language-python"><span class="n">TE_MAGIC</span> <span class="o">=</span> <span class="s">"VZ"</span>

<span class="k">def</span> <span class="nf">accept_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">TE_MAGIC</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="s">"TE executable"</span>

    <span class="k">return</span> <span class="n">retval</span></code></pre>

<p>The <code>f</code> parameter here is an open file handle, and n is the number of times this loader has been queried so far (not really important for this type of loader). If it looks good, we return the string that will appear in IDA’s “Load a new file” window, otherwise return 0.</p>

<p><code>load_file()</code> is where the good stuff happens. As the name indicates, this function is called by IDA to actually perform the loading of the file. Hurr.</p>

<pre><code class="language-python"><span class="n">SECTION_CLASSES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">b</span><span class="s">".text</span><span class="se">\0\0\0</span><span class="s">"</span><span class="p">:</span> <span class="s">"CODE"</span><span class="p">,</span>
    <span class="n">b</span><span class="s">".data</span><span class="se">\0\0\0</span><span class="s">"</span><span class="p">:</span> <span class="s">"DATA"</span><span class="p">,</span>
    <span class="n">b</span><span class="s">".reloc</span><span class="se">\0\0</span><span class="s">"</span><span class="p">:</span>  <span class="s">"DATA"</span><span class="p">,</span>
    <span class="n">b</span><span class="s">"_TEXT_RE"</span><span class="p">:</span>    <span class="s">"CODE"</span><span class="p">,</span>
    <span class="n">b</span><span class="s">"_TEXT_PR"</span><span class="p">:</span>    <span class="s">"CODE"</span>
<span class="p">}</span>

<span class="n">SECTION_MODES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">b</span><span class="s">"_TEXT_RE"</span><span class="p">:</span>    <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">neflags</span><span class="p">,</span> <span class="n">format</span><span class="p">):</span>
    <span class="c"># parse header</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">te</span> <span class="o">=</span> <span class="n">TEImage</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c"># load binary</span>
    <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">te</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
        <span class="n">seg_type</span> <span class="o">=</span> <span class="n">SECTION_CLASSES</span><span class="p">[</span><span class="n">sec</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">sec</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">SECTION_CLASSES</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s">"DATA"</span>
        <span class="n">seg_mode</span> <span class="o">=</span> <span class="n">SECTION_MODES</span><span class="p">[</span><span class="n">sec</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">sec</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">SECTION_MODES</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">file2base</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="n">sec</span><span class="o">.</span><span class="n">virt_addr</span><span class="p">,</span> <span class="n">sec</span><span class="o">.</span><span class="n">virt_addr</span> <span class="o">+</span> <span class="n">sec</span><span class="o">.</span><span class="n">data_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">add_segm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sec</span><span class="o">.</span><span class="n">virt_addr</span><span class="p">,</span> <span class="n">sec</span><span class="o">.</span><span class="n">virt_addr</span> <span class="o">+</span> <span class="n">sec</span><span class="o">.</span><span class="n">virt_size</span><span class="p">,</span> <span class="n">sec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">seg_type</span><span class="p">)</span>
        <span class="n">set_segm_addressing</span><span class="p">(</span><span class="n">get_segm_by_name</span><span class="p">(</span><span class="n">sec</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">seg_mode</span><span class="p">)</span>

    <span class="n">add_entry</span><span class="p">(</span><span class="n">te</span><span class="o">.</span><span class="n">entry_point_addr</span><span class="p">,</span> <span class="n">te</span><span class="o">.</span><span class="n">entry_point_addr</span><span class="p">,</span> <span class="s">"_start"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">1</span></code></pre>

<p>So we first use the classes we built earlier to parse the headers. Then for each section (segment) we need to determine the class (ie. whether it’s data or code or relocations or whatever), and the addressing mode (this is important because the entry point will be in 16-bit mode). Call <code>file2base()</code> to read the section’s data into IDA at the virtual address specified in the section header, <code>add_segm()</code> to create a segment of the appropriate type at this virtual address, and <code>set_segm_addressing()</code> to mark the segment as 16-bit if necessary. Once we’ve added all the segments into IDA we mark the entry point, and return 1 to tell IDA all is well.</p>

<p>To install the loader, I just symlinked it into IDA’s loaders directory. On OS X this is actually inside the application bundle at <em>idaq.app/Contents/MacOS/loaders/</em> (idaq64.app looks inside idaq.app as well).</p>

<p>Now when we open IDA and drop in our TE binary we get some good news:</p>

<p><img src="/posts/2012/12/load.png" alt="load"></p>

<p>The binary is processed and the <code>.text</code> segment looks OK:</p>

<p><img src="/posts/2012/12/text.png" alt="text"></p>

<p>And here’s the entry point in 16-bit mode, the first bit of code executed by the CPU when you power on the Mac:</p>

<p><img src="/posts/2012/12/entry.png" alt="text"></p>

<p>You can see it there loading the GDT, and enabling protected mode and SSE extensions before carrying on with the rest of the CPU init stuff. Good times.</p>

<p>So there you go - a simple binary loader for IDA Pro in Python. I haven’t bothered implementing relocation fixups and whatnot yet, but I probably will at some stage. It’s 2:41am and I’m tired. The source code is in the <a href="https://github.com/snarez/ida-efiutils">ida-efiutils</a> package on Github.</p>

	<hr/>

<div id="pagination_data">
	<div style="float: left"><a href="/posts/archive/1/">&lt;&lt; Older posts</a></div>
	<div style="float: right">&nbsp;</div>
</div>
              </div>
            </div>
            <div class="grid_3">
              <div id="sidebar">
                <h2>PAGES</h2>
                <ul>
                  <li><a href="/">Home</a></li>
                  <li><a href="/about">About</a></li>
                  <li><a href="/downloads">Downloads</a></li>
                </ul>
                <h2>TAGS</h2>
                <p><a class="tagcloud" style="font-size:78.23529411764706%;" href="/tag/voltron/" rel="tag">voltron</a> <a class="tagcloud" style="font-size:85.29411764705883%;" href="/tag/debugging/" rel="tag">debugging</a> <a class="tagcloud" style="font-size:85.29411764705883%;" href="/tag/gdb/" rel="tag">gdb</a> <a class="tagcloud" style="font-size:64.11764705882352%;" href="/tag/lldb/" rel="tag">lldb</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/calculon/" rel="tag">calculon</a> <a class="tagcloud" style="font-size:120.58823529411765%;" href="/tag/efi/" rel="tag">efi</a> <a class="tagcloud" style="font-size:71.17647058823529%;" href="/tag/ida pro/" rel="tag">ida pro</a> <a class="tagcloud" style="font-size:64.11764705882352%;" href="/tag/idapython/" rel="tag">idapython</a> <a class="tagcloud" style="font-size:64.11764705882352%;" href="/tag/reversing/" rel="tag">reversing</a> <a class="tagcloud" style="font-size:85.29411764705883%;" href="/tag/rootkits/" rel="tag">rootkits</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/refind/" rel="tag">refind</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/black hat/" rel="tag">black hat</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/firmware/" rel="tag">firmware</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/bus pirate/" rel="tag">bus pirate</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/flashrom/" rel="tag">flashrom</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/pci/" rel="tag">pci</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/syscan/" rel="tag">syscan</a> <a class="tagcloud" style="font-size:78.23529411764706%;" href="/tag/mac os x/" rel="tag">mac os x</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/x86-64/" rel="tag">x86-64</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/clang/" rel="tag">clang</a> <a class="tagcloud" style="font-size:71.17647058823529%;" href="/tag/kernel/" rel="tag">kernel</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/kexts/" rel="tag">kexts</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/mach-o/" rel="tag">mach-o</a> <a class="tagcloud" style="font-size:57.05882352941176%;" href="/tag/python/" rel="tag">python</a> <a class="tagcloud" style="font-size:64.11764705882352%;" href="/tag/vmware/" rel="tag">vmware</a> </p>
                <h2>POSTS</h2>
                <ul>
                  
                    <li><a href="/posts/2015/05/building-voltron-command-plugins/">Building Voltron Command Plugins</a></li>
                  
                    <li><a href="/posts/2014/12/building-voltron-views/">Building Voltron Views</a></li>
                  
                    <li><a href="/posts/2013/10/calculon-a-calculator-for-nerds/">Calculon - a calculator for nerds</a></li>
                  
                    <li><a href="/posts/2013/06/voltron-a-hacky-ui-for-gdb/">Voltron - a hacky UI for GDB</a></li>
                  
                    <li><a href="/posts/2012/12/te-loader-for-ida-pro/">TE loader for IDA Pro</a></li>
                  
                    <li><a href="/posts/2012/10/ruxcon/">Ruxcon 2012</a></li>
                  
                    <li><a href="/posts/2012/09/ida-pro-scripts-for-efi-reversing/">IDA Pro scripts for EFI reversing</a></li>
                  
                    <li><a href="/posts/2012/08/building-refind-with-edk2-on-osx/">Building rEFInd with EDKII on Mac OS X</a></li>
                  
                    <li><a href="/posts/2012/07/black-hat-usa-2012/">Black Hat USA 2012</a></li>
                  
                    <li><a href="/posts/2012/06/unbricking-a-macbook/">Un-bricking a MacBook</a></li>
                  
                    <li><a href="/posts/2012/06/send-me-your-lspci/">Send me your `lspci -vv`</a></li>
                  
                    <li><a href="/posts/2012/05/syscan-2012-is-over/">SyScan 2012 is Over</a></li>
                  
                    <li><a href="/posts/2012/03/rip-relative-addressing-and-kernel-payloads/">RIP-Relative Addressing and Kernel Payloads</a></li>
                  
                    <li><a href="/posts/2012/02/resolving-kernel-symbols/">Resolving kernel symbols</a></li>
                  
                    <li><a href="/posts/2012/02/carving-up-efi-fat-binaries/">Carving up EFI fat binaries</a></li>
                  
                    <li><a href="/posts/2012/02/vmware-hardware-debugging/">VMware debugging II&#58; "Hardware" debugging</a></li>
                  
                    <li><a href="/posts/2012/02/debugging-the-mac-os-x-kernel-with-vmware-and-gdb/">Debugging the Mac OS X kernel with VMware and GDB</a></li>
                  
                </ul>
                <h2>SEARCH</h2>
                <form method="get" action="http://www.google.com/search">
                  <fieldset>
                    <input type="hidden" name="sitesearch" value="ho.ax"/>
                    <input type="text" class="searchbox" name="q" size="31" maxlength="255" value=""/>
                    <input type="image" class="searchbutton" width=24 height=24 src="/img/search.png" value="Search"/>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="splitbar">&nbsp;</div>
      <div id="footer">
          <div class="container_12">
            <div class="grid_9">
              <p>Last updated on 9 May 2015 by . Please don't steal my stuff.</p>
            </div>
            <div class="grid_3">
              <div class="media">
                <div style="float: left"><a class="twitter" href="http://twitter.com/snare"></a></div>
                <div style="float: left"><a class="rss" href="/feed.xml"></a></div>
              </div>
            </div>
        </div>
      </div>
    </div>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29183428-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
  <img src="/img/twitter_active.png" style="display: none" />
  <img src="/img/rss_active.png" style="display: none" />
  </body>
</html>
